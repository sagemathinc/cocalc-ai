# Slate

## Ideas for Quality Improvements and Optimizations of Core Implementations

- [ ] Scope the `selectionchange` listener to focus/blur instead of always\-on. Right now it’s attached globally in [src/packages/frontend/editors/slate/slate\-react/components/selection\-sync.ts](./src/packages/frontend/editors/slate/slate-react/components/selection-sync.ts); only listening while the editor is focused reduces noise and cross\-editor interference.
- [ ] Skip `updateDOMSelection` when Slate selection hasn’t changed. You can track a `lastSelection` ref and early\-return in [src/packages/frontend/editors/slate/slate\-react/components/selection\-sync.ts](./src/packages/frontend/editors/slate/slate-react/components/selection-sync.ts); it cuts a lot of needless DOM selection churn.
- [ ] Debounce `scrollCaretIntoView` to once per animation frame and skip on programmatic updates. It’s currently in a layout effect in [src/packages/frontend/editors/slate/slate\-react/components/editable.tsx](./src/packages/frontend/editors/slate/slate-react/components/editable.tsx) and can run very frequently under load.
- [ ] Reduce per\-render work in `Children`: `Editor.range` and `Range.intersection` are done per child every render, especially heavy without windowing. Consider caching per node key or only computing decorations for visible nodes in [src/packages/frontend/editors/slate/slate\-react/components/children.tsx](./src/packages/frontend/editors/slate/slate-react/components/children.tsx).
- [ ] Avoid updating `NODE_TO_INDEX` / `NODE_TO_PARENT` for the full tree on every render. In [src/packages/frontend/editors/slate/slate\-react/components/children.tsx](./src/packages/frontend/editors/slate/slate-react/components/children.tsx) this runs for every child; shifting to incremental updates during `apply` \(similar to how you handle `NODE_TO_KEY`\) would scale better on huge docs.
- [ ] Add a lightweight invariant guard around `toSlateRange` / `toDOMRange` errors. You already catch/log, but formalizing a “leave selection unchanged if mapping fails” rule in [src/packages/frontend/editors/slate/slate\-react/components/selection\-sync.ts](./src/packages/frontend/editors/slate/slate-react/components/selection-sync.ts) reduces unexpected jumps.
- [ ] Use `Editor.withoutNormalizing` around bulk changes in markdown sync to reduce redundant normalization passes. The hot path is in [src/packages/frontend/editors/slate/editable\-markdown.tsx](./src/packages/frontend/editors/slate/editable-markdown.tsx).
- [ ] Add a targeted regression test harness for selection mapping with zero\-width spans, placeholders, and voids. Those are the risk zones in [src/packages/frontend/editors/slate/slate\-react/components/string.tsx](./src/packages/frontend/editors/slate/slate-react/components/string.tsx) and [src/packages/frontend/editors/slate/slate\-react/plugin/react\-editor.ts](./src/packages/frontend/editors/slate/slate-react/plugin/react-editor.ts); a Playwright test or a small jsdom harness would be enough to catch drift.
- [ ] Make selection/mismatch logging configurable via an env flag. That keeps production logs clean but gives you a switch when you need deep diagnostics, still centered in [src/packages/frontend/editors/slate/slate\-react/components/selection\-sync.ts](./src/packages/frontend/editors/slate/slate-react/components/selection-sync.ts).

